<!DOCTYPE html>
<html>
<head>
<title>GuÃ­a UX - AcademiaAPP Android</title>
<meta charset="UTF-8">
<meta name="version" content="2.0.0">
<meta name="author" content="Ãngel FernÃ¡ndez Vidal">
<meta name="project" content="TFG FP DAM - AcademiaAPP">
<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Ubuntu", sans-serif;
    font-size: 14px;
    padding: 0 26px;
    line-height: 22px;
    word-wrap: break-word;
    max-width: 1200px;
    margin: 0 auto;
}

h1 {
    padding-bottom: 0.3em;
    line-height: 1.2;
    border-bottom: 2px solid #128C7E;
    color: #128C7E;
}

h2 {
    padding-bottom: 0.3em;
    border-bottom: 1px solid #f0f0f0;
    margin-top: 32px;
    color: #1EBEA5;
}

h3 {
    margin-top: 20px;
    color: #333;
}

table {
    border-collapse: collapse;
    width: 100%;
    margin: 16px 0;
}

table th {
    background-color: #ECE5DD;
    text-align: left;
    padding: 12px;
    border: 1px solid #ddd;
    font-weight: 600;
}

table td {
    padding: 10px 12px;
    border: 1px solid #ddd;
    vertical-align: top;
}

table tr:nth-child(even) {
    background-color: #fafafa;
}

code {
    background-color: #ECE5DD;
    padding: 2px 6px;
    border-radius: 3px;
    font-family: 'Courier New', monospace;
    font-size: 13px;
}

pre {
    background-color: #f8f8f8;
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 16px;
    overflow-x: auto;
    font-family: 'Courier New', monospace;
    font-size: 12px;
}

.color-box {
    display: inline-block;
    width: 60px;
    height: 30px;
    border: 1px solid #ccc;
    vertical-align: middle;
    margin-right: 8px;
    border-radius: 4px;
}

.info-box {
    background-color: #E3F2FD;
    border-left: 4px solid #2196F3;
    padding: 12px;
    margin: 16px 0;
    border-radius: 4px;
}

.component-box {
    background-color: #F3E5F5;
    border-left: 4px solid #9C27B0;
    padding: 12px;
    margin: 16px 0;
    border-radius: 4px;
}

.interaction-box {
    background-color: #E8F5E9;
    border-left: 4px solid #4CAF50;
    padding: 12px;
    margin: 16px 0;
    border-radius: 4px;
}

.screen-layout {
    border: 2px solid #128C7E;
    border-radius: 8px;
    padding: 16px;
    margin: 16px 0;
    background: linear-gradient(135deg, #f5f7fa 0%, #ECE5DD 30%);
}

.chat-bubble-user {
    background-color: #DCF8C6;
    color: #000000;
    padding: 12px;
    border-radius: 12px 12px 12px 4px;
    margin: 8px 0 8px 60px;
    max-width: 80%;
    float: right;
    clear: both;
}

.chat-bubble-assistant {
    background-color: #FFFFFF;
    color: #000000;
    border: 1px solid #e0e0e0;
    padding: 12px;
    border-radius: 12px 12px 4px 12px;
    margin: 8px 60px 8px 0;
    max-width: 80%;
    float: left;
    clear: both;
}

@media print {
    * {
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
    }
}
</style>
</head>
<body>

<h1>GuÃ­a de Experiencia de Usuario</h1>
<h2>AcademiaAPP - AplicaciÃ³n Android</h2>

<p><strong>Proyecto:</strong> TFG FP DAM - Sistema Academia Chat-Driven<br>
<strong>Autor:</strong> Ãngel FernÃ¡ndez Vidal<br>
<strong>Fecha:</strong> Noviembre 2025<br>
<strong>TecnologÃ­a:</strong> Kotlin + Jetpack Compose + Material Design 3</p>

<hr>

<h2>Ãndice</h2>
<ol>
<li><a href="#paleta-colores">Paleta de Colores Real</a></li>
<li><a href="#login">Pantalla de Login</a></li>
<li><a href="#chat">Pantalla de Chat</a></li>
<li><a href="#mensajes">Burbujas de Mensajes</a></li>
<li><a href="#tarjetas">Tarjetas de Datos (DataCards)</a></li>
<li><a href="#sugerencias">SuggestionChips</a></li>
<li><a href="#loading">Estados de Carga</a></li>
<li><a href="#navegacion">NavegaciÃ³n con Drawer</a></li>
<li><a href="#interacciones">Interacciones Clave</a></li>
</ol>

<hr>

<h2 id="paleta-colores">1. Paleta de Colores Real</h2>

<p>ExtraÃ­do de <code>ui/theme/Color.kt</code>:</p>

<table>
<tr>
<th>Color</th>
<th>CÃ³digo</th>
<th>Uso en la App</th>
</tr>
<tr>
<td><div class="color-box" style="background: #128C7E;"></div></td>
<td><code>#128C7E</code></td>
<td><strong>WhatsPrimaryLight</strong> - TopAppBar, StatusBar, botÃ³n enviar</td>
</tr>
<tr>
<td><div class="color-box" style="background: #1EBEA5;"></div></td>
<td><code>#1EBEA5</code></td>
<td><strong>WhatsPrimaryDark</strong> - Modo oscuro (no implementado aÃºn)</td>
</tr>
<tr>
<td><div class="color-box" style="background: #ECE5DD;"></div></td>
<td><code>#ECE5DD</code></td>
<td><strong>ChatBgLight</strong> - Fondo del chat (modo claro)</td>
</tr>
<tr>
<td><div class="color-box" style="background: #0B141A;"></div></td>
<td><code>#0B141A</code></td>
<td><strong>ChatBgDark</strong> - Fondo del chat (modo oscuro)</td>
</tr>
<tr>
<td><div class="color-box" style="background: #DCF8C6;"></div></td>
<td><code>#DCF8C6</code></td>
<td><strong>ChatUserBubble</strong> - Burbuja de mensajes del usuario</td>
</tr>
<tr>
<td><div class="color-box" style="background: #FFFFFF; border: 1px solid #ccc;"></div></td>
<td><code>#FFFFFF</code></td>
<td><strong>ChatAssistantBubble</strong> - Burbuja de mensajes del asistente</td>
</tr>
<tr>
<td><div class="color-box" style="background: #000000;"></div></td>
<td><code>#000000</code></td>
<td><strong>TextBlack</strong> - Texto principal en burbujas</td>
</tr>
</table>

<div class="info-box">
<strong>ğŸ“Œ Nota:</strong> La paleta sigue el esquema visual de WhatsApp para familiaridad del usuario. Verde turquesa para elementos activos, beige claro para el fondo del chat.
</div>

<hr>

<h2 id="login">2. Pantalla de Login</h2>

<p>ExtraÃ­do de <code>ui/screens/LoginScreen.kt</code>:</p>

<h3>Layout</h3>
<div class="screen-layout">
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ StatusBar (#128C7E)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                        â”‚
â”‚   [CÃ­rculos decorativos de fondo]     â”‚
â”‚                                        â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚        â”‚  CARD LOGIN      â”‚            â”‚
â”‚        â”‚                  â”‚            â”‚
â”‚        â”‚  "Iniciar sesiÃ³n"â”‚            â”‚
â”‚        â”‚                  â”‚            â”‚
â”‚        â”‚  [Usuario]       â”‚            â”‚
â”‚        â”‚  [ContraseÃ±a]    â”‚            â”‚
â”‚        â”‚                  â”‚            â”‚
â”‚        â”‚  â˜ Recordar     â”‚            â”‚
â”‚        â”‚                  â”‚            â”‚
â”‚        â”‚  Â¿Olvidaste...? â”‚            â”‚
â”‚        â”‚                  â”‚            â”‚
â”‚        â”‚  [ ACCEDER ]     â”‚            â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
</div>

<h3>Elementos UI Implementados</h3>
<table>
<tr>
<th>Componente</th>
<th>Tipo</th>
<th>CaracterÃ­sticas</th>
</tr>
<tr>
<td><strong>Fondo degradado</strong></td>
<td><code>Box + Brush.verticalGradient</code></td>
<td>Primary.copy(alpha=0.3f) â†’ PrimaryContainer.copy(alpha=0.5f) â†’ #E8F5E9</td>
</tr>
<tr>
<td><strong>CÃ­rculos decorativos</strong></td>
<td><code>Box + CircleShape</code></td>
<td>3 cÃ­rculos con alpha 0.1-0.12, posicionados con offset negativo</td>
</tr>
<tr>
<td><strong>Card central</strong></td>
<td><code>Card</code></td>
<td>RoundedCornerShape(24.dp), elevation 16.dp, fondo blanco 95% opacidad</td>
</tr>
<tr>
<td><strong>Campo Usuario</strong></td>
<td><code>OutlinedTextField</code></td>
<td>Label: "Usuario", texto negro (#000000), sin validaciÃ³n compleja</td>
</tr>
<tr>
<td><strong>Campo ContraseÃ±a</strong></td>
<td><code>OutlinedTextField</code></td>
<td>PasswordVisualTransformation + icono ojo mostrar/ocultar (ic_eye / ic_eye_off)</td>
</tr>
<tr>
<td><strong>Checkbox "Recordar"</strong></td>
<td><code>Checkbox</code></td>
<td>TamaÃ±o 24.dp, colors personalizados (checked=negro, unchecked=blanco)</td>
</tr>
<tr>
<td><strong>Link "Â¿Olvidaste?"</strong></td>
<td><code>TextButton</code></td>
<td>Color azul oscuro (#1565C0), sin funcionalidad implementada</td>
</tr>
<tr>
<td><strong>BotÃ³n Acceder</strong></td>
<td><code>Button</code></td>
<td>fillMaxWidth(), color primary (#128C7E), texto "Accediendo..." si loading</td>
</tr>
</table>

<h3>Estados del BotÃ³n</h3>
<div class="component-box">
<strong>Estado Habilitado:</strong> Requiere <code>username.isNotBlank()</code> Y <code>password.isNotBlank()</code><br>
<strong>Estado Loading:</strong> BotÃ³n deshabilitado, texto "Accediendo...", alpha 0.5f<br>
<strong>Estado Error:</strong> Snackbar roja con mensaje, campos mantienen valores ingresados
</div>

<h3>NavegaciÃ³n Post-Login</h3>
<pre>
if (uiState.mustChangePassword) {
    navController.navigate("change_password_required")
} else {
    navController.navigate("chat?fromLogin=true")
}
</pre>

<hr>

<h2 id="chat">3. Pantalla de Chat</h2>

<p>ExtraÃ­do de <code>ui/screens/ChatScreen.kt</code>:</p>

<h3>Estructura Scaffold</h3>
<div class="screen-layout">
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AppTopBar                                â”‚ â† height: 56.dp, color: #128C7E
â”‚ â˜° [Logo/Nombre Usuario]          [MenÃº] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  LazyColumn (mensajes)                   â”‚ â† bg: #ECE5DD (claro) o #0B141A (oscuro)
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Burbuja Asistente (#FFFFFF)    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚                â”‚ Burbuja Usuario        â”‚â”‚
â”‚                â”‚ (#DCF8C6)              â”‚â”‚
â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Burbuja Asistente con tarjetas â”‚      â”‚
â”‚  â”‚ [DataCard]  [DataCard]         â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                          â”‚
â”‚ [Sugerencias]                            â”‚ â† SuggestionChips horizontal scroll
â”‚ [ğŸ“Š Clases] [ğŸ‘¥ Alumnos] [ğŸ“ Lista]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MessageInput                             â”‚ â† OutlinedTextField + FloatingActionButton
â”‚ [Escribe un mensaje...]            [â†‘]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
</div>

<h3>Componentes Principales</h3>

<h4>AppTopBar (ui/components/AppTopBar.kt)</h4>
<table>
<tr>
<th>Propiedad</th>
<th>Valor</th>
</tr>
<tr>
<td>height</td>
<td>56.dp</td>
</tr>
<tr>
<td>backgroundColor</td>
<td>MaterialTheme.colorScheme.primary (#128C7E)</td>
</tr>
<tr>
<td>contentColor</td>
<td>MaterialTheme.colorScheme.onPrimary (blanco)</td>
</tr>
<tr>
<td>showNavIcon</td>
<td>true (icono â˜° menÃº hamburguesa)</td>
</tr>
<tr>
<td>StatusBar sync</td>
<td>window.statusBarColor = backgroundColor.toArgb()</td>
</tr>
</table>

<h4>LazyColumn (Lista de Mensajes)</h4>
<pre>
LazyColumn(
    state = listState,
    modifier = Modifier
        .fillMaxSize()
        .padding(horizontal = 12.dp, vertical = 8.dp),
    verticalArrangement = Arrangement.spacedBy(8.dp)
) {
    itemsIndexed(ui.messages) { index, m ->
        // Render bubble
    }
}
</pre>

<div class="info-box">
<strong>Auto-scroll:</strong> Usa <code>LaunchedEffect(ui.messages.size, ui.loading)</code> para scroll automÃ¡tico al Ãºltimo mensaje cuando cambia la lista o aparece loading.
</div>

<h4>MessageInput (Campo de Texto + BotÃ³n)</h4>
<pre>
Row(
    modifier = Modifier
        .fillMaxWidth()
        .background(chatBackground)
        .padding(8.dp)
) {
    OutlinedTextField(
        value = inputText,
        onValueChange = { ... },
        placeholder = { Text("Escribe un mensaje...") },
        modifier = Modifier.weight(1f)
    )
    Spacer(8.dp)
    FloatingActionButton(
        onClick = { vm.sendMessage(inputText) },
        containerColor = MaterialTheme.colorScheme.primary,
        shape = CircleShape
    ) {
        Icon(Icons.AutoMirrored.Filled.Send, "Enviar mensaje")
    }
}
</pre>

<hr>

<h2 id="mensajes">4. Burbujas de Mensajes</h2>

<h3>Burbuja de Usuario</h3>
<table>
<tr>
<th>Propiedad</th>
<th>Valor</th>
</tr>
<tr>
<td>backgroundColor</td>
<td><code>#DCF8C6</code> (verde claro WhatsApp)</td>
</tr>
<tr>
<td>textColor</td>
<td><code>#000000</code></td>
</tr>
<tr>
<td>alignment</td>
<td><code>Alignment.CenterEnd</code> (derecha)</td>
</tr>
<tr>
<td>shape</td>
<td>
<code>RoundedCornerShape(
    topStart = 12.dp,
    topEnd = 12.dp,
    bottomStart = 12.dp,
    bottomEnd = 4.dp
)</code>
</td>
</tr>
<tr>
<td>maxWidth</td>
<td>80% del ancho de pantalla</td>
</tr>
</table>

<div class="chat-bubble-user">
MuÃ©strame las clases de hoy
</div>
<div style="clear: both;"></div>

<h3>Burbuja del Asistente</h3>
<table>
<tr>
<th>Propiedad</th>
<th>Valor</th>
</tr>
<tr>
<td>backgroundColor</td>
<td><code>#FFFFFF</code></td>
</tr>
<tr>
<td>textColor</td>
<td><code>#000000</code></td>
</tr>
<tr>
<td>alignment</td>
<td><code>Alignment.CenterStart</code> (izquierda)</td>
</tr>
<tr>
<td>shape</td>
<td>
<code>RoundedCornerShape(
    topStart = 12.dp,
    topEnd = 12.dp,
    bottomEnd = 12.dp,
    bottomStart = 4.dp
)</code>
</td>
</tr>
<tr>
<td>maxWidth</td>
<td>80% (sin tabla) / 95% (con tabla)</td>
</tr>
</table>

<div class="chat-bubble-assistant">
Tus clases de hoy - MiÃ©rcoles 23 de octubre:<br>
Tienes <strong>3 sesiones</strong> programadas.
</div>
<div style="clear: both;"></div>

<hr>

<h2 id="tarjetas">5. Tarjetas de Datos (DataCards)</h2>

<p>ExtraÃ­do de <code>ui/screens/components/SesionesDelDiaCards.kt</code>:</p>

<h3>AnatomÃ­a de una SesionesDelDiaCard</h3>
<pre>
Card(
    modifier = Modifier.fillMaxWidth(),
    shape = RoundedCornerShape(8.dp),
    colors = CardDefaults.cardColors(
        containerColor = MaterialTheme.colorScheme.surfaceVariant.copy(alpha = 0.5f)
    ),
    border = BorderStroke(1.dp, MaterialTheme.colorScheme.outline.copy(alpha = 0.3f))
) {
    Column(padding = 12.dp, spacing = 6.dp) {
        // LÃ­nea 1: Horario + Aula
        Row {
            Text("08:00 - 10:00", style = titleMedium, fontWeight = Bold)
            Text("| Aula 3", style = bodyMedium)
        }
        
        // LÃ­nea 2: Curso
        Text("MatemÃ¡ticas 1Âº ESO", style = bodyLarge, fontWeight = Medium)
        
        // LÃ­nea 3: DescripciÃ³n estado
        Text("SesiÃ³n no iniciada", style = bodySmall, color = onSurfaceVariant)
        
        // LÃ­nea 4: Alumnos
        Text("18 alumnos", style = bodySmall)
        
        // LÃ­nea 5: Acciones
        if (acciones.isNotEmpty()) {
            HorizontalDivider(...)
            Row {
                acciones.forEach { accion ->
                    OutlinedButton(
                        onClick = { ... },
                        height = 36.dp,
                        contentPadding = PaddingValues(12.dp, 4.dp)
                    ) {
                        Text(accion, style = labelMedium)
                    }
                }
            }
        }
    }
}
</pre>

<h3>Tipos de Tarjetas Implementadas</h3>
<table>
<tr>
<th>Componente</th>
<th>Archivo</th>
<th>Uso</th>
</tr>
<tr>
<td><code>SesionesDelDiaCards</code></td>
<td><code>components/SesionesDelDiaCards.kt</code></td>
<td>Clases del dÃ­a con estado, horario, curso, acciones (Ver alumnos, Pasar lista, Iniciar)</td>
</tr>
<tr>
<td><code>SesionesSemanalesTable</code></td>
<td><code>components/SesionesSemanalesTable.kt</code></td>
<td>Vista semanal con dÃ­as expandibles (icono UnfoldMore para expandir horarios)</td>
</tr>
<tr>
<td><code>CompactList</code></td>
<td><code>components/CompactList.kt</code></td>
<td>Listas genÃ©ricas con icono ğŸ” (Search) en Ãºltima columna para ver detalles</td>
</tr>
<tr>
<td><code>AlumnosSesionTable</code></td>
<td><code>components/AlumnosSesionTable.kt</code></td>
<td>Lista de alumnos con checkboxes asistencia (âœ…/âŒ) y icono ğŸ“ para anotaciones</td>
</tr>
</table>

<hr>

<h2 id="sugerencias">6. SuggestionChips</h2>

<p>ExtraÃ­do de <code>ChatScreen.kt</code> lÃ­neas 962-1050:</p>

<h3>ImplementaciÃ³n</h3>
<pre>
Row(
    modifier = Modifier
        .fillMaxWidth()
        .horizontalScroll(rememberScrollState())
        .padding(horizontal = 12.dp, vertical = 8.dp),
    horizontalArrangement = Arrangement.spacedBy(8.dp)
) {
    suggestions.forEach { suggestion ->
        SuggestionChip(
            onClick = {
                vm.disableSuggestionsForMessage(index)
                vm.sendMessage(suggestion.displayText)
            },
            label = { Text(suggestion.displayText) },
            enabled = !ui.loading && m.suggestionsEnabled
        )
    }
}
</pre>

<h3>Tipos de Sugerencias</h3>
<table>
<tr>
<th>Tipo</th>
<th>Comportamiento</th>
<th>Ejemplo</th>
</tr>
<tr>
<td><strong>NavegaciÃ³n (pagination)</strong></td>
<td>Chips con iconos de flecha (prev/next), ordenados por direcciÃ³n</td>
<td>
â† PÃ¡gina anterior | PÃ¡gina siguiente â†’
</td>
</tr>
<tr>
<td><strong>Acciones contextuales</strong></td>
<td>Chips sin icono, texto descriptivo</td>
<td>"Ver clases de ayer", "Buscar alumno"</td>
</tr>
<tr>
<td><strong>Filtros</strong></td>
<td>Chips que envÃ­an mensaje con contexto adicional</td>
<td>"Solo alumnos activos", "Solo completadas"</td>
</tr>
</table>

<div class="interaction-box">
<strong>Deshabilitar sugerencias:</strong> Cuando el usuario hace tap en un chip o escribe un nuevo mensaje, se llama a <code>vm.disableSuggestionsForMessage(index)</code> para que los chips del mensaje anterior desaparezcan (evita saturaciÃ³n visual).
</div>

<h3>Iconos de PaginaciÃ³n</h3>
<pre>
val icon = when (suggestion.pagination?.direction) {
    "prev" -> Icons.AutoMirrored.Filled.KeyboardArrowLeft
    "next" -> Icons.AutoMirrored.Filled.KeyboardArrowRight
    else -> null
}
</pre>

<hr>

<h2 id="loading">7. Estados de Carga</h2>

<p>ExtraÃ­do de <code>ui/screens/components/TypingIndicator.kt</code>:</p>

<h3>TypingIndicator (AnimaciÃ³n de 3 Puntos)</h3>
<pre>
@Composable
fun TypingIndicator(dotColor: Color = Color(0xFF555555)) {
    // 3 dots animados con offset vertical
    Row(spacing = 4.dp) {
        Box(
            modifier = Modifier
                .size(8.dp)
                .offset(y = offsetY1.dp)  // animateFloat 0f â†’ -8f
                .background(dotColor, CircleShape)
        )
        Box(
            modifier = Modifier
                .size(8.dp)
                .offset(y = offsetY2.dp)  // delay 200ms
                .background(dotColor, CircleShape)
        )
        Box(
            modifier = Modifier
                .size(8.dp)
                .offset(y = offsetY3.dp)  // delay 400ms
                .background(dotColor, CircleShape)
        )
    }
}
</pre>

<h3>Uso del TypingIndicator</h3>
<table>
<tr>
<th>Contexto</th>
<th>UbicaciÃ³n</th>
</tr>
<tr>
<td><strong>Mensaje de bienvenida inicial</strong></td>
<td>Centrado en pantalla vacÃ­a dentro de Card blanco con elevation 4.dp</td>
</tr>
<tr>
<td><strong>Respuesta en proceso</strong></td>
<td>Ãšltima burbuja del asistente (blanca) mientras <code>ui.loading == true</code></td>
</tr>
</table>

<div class="component-box">
<strong>AnimaciÃ³n:</strong> infiniteRepeatable con tween(600ms), RepeatMode.Reverse, efecto de "ola" vertical (-8dp offset).
</div>

<hr>

<h2 id="navegacion">8. NavegaciÃ³n con Drawer</h2>

<p>ExtraÃ­do de <code>ChatScreen.kt</code> lÃ­neas 230-295:</p>

<h3>ModalNavigationDrawer</h3>
<pre>
ModalNavigationDrawer(
    drawerState = drawerState,
    drawerContent = {
        ModalDrawerSheet {
            // Header con fondo primary
            Column(
                modifier = Modifier
                    .fillMaxWidth()
                    .background(MaterialTheme.colorScheme.primary)
                    .padding(16.dp)
            ) {
                Text(userName, color = onPrimary)
                Text(academiaName ?: "Academia vinculada", color = onPrimary)
            }
            
            // Opciones dinÃ¡micas segÃºn rol
            menuOptions.forEach { option ->
                NavigationDrawerItem(
                    label = { Text(option.label) },
                    icon = { Icon(option.icon, "") },
                    selected = option.id == "chat_libre",
                    onClick = { /* acciÃ³n */ }
                )
            }
        }
    }
) {
    // Contenido del chat
}
</pre>

<h3>Opciones del MenÃº (MenuBuilder.kt)</h3>
<table>
<tr>
<th>ID</th>
<th>Label</th>
<th>Icono</th>
<th>AcciÃ³n</th>
</tr>
<tr>
<td><code>chat_libre</code></td>
<td>Chat Libre</td>
<td>Chat icon</td>
<td>Navegar a <code>/chat</code></td>
</tr>
<tr>
<td><code>mis_clases_hoy</code></td>
<td>Mis clases de hoy</td>
<td>Calendar icon</td>
<td>Enviar mensaje automÃ¡tico: "MuÃ©strame mis clases de hoy"</td>
</tr>
<tr>
<td><code>mis_alumnos</code></td>
<td>Mis alumnos</td>
<td>People icon</td>
<td>Enviar mensaje: "Ver todos mis alumnos"</td>
</tr>
<tr>
<td><code>cerrar_sesion</code></td>
<td>Cerrar SesiÃ³n</td>
<td>Logout icon</td>
<td>Reset ViewModel, clear session, navegar a <code>/login</code></td>
</tr>
</table>

<div class="info-box">
<strong>Auto-envÃ­o de mensajes:</strong> Opciones como "Mis clases de hoy" no abren nueva pantalla, sino que envÃ­an un mensaje al chat automÃ¡ticamente usando <code>option.chatMessage</code>.
</div>

<hr>

<h2 id="interacciones">9. Interacciones Clave</h2>

<h3>1. Pasar Lista (AlumnosSesionTable)</h3>
<div class="interaction-box">
<strong>Flujo:</strong><br>
1. Usuario hace tap en "Pasar lista" desde tarjeta de sesiÃ³n<br>
2. Chat muestra tabla con checkboxes (âœ…/âŒ) por cada alumno<br>
3. Usuario toca checkboxes para marcar ausencias<br>
4. BotÃ³n "Confirmar Asistencia" en footer de tabla<br>
5. EnvÃ­o de <code>POST /sesiones/{id}/pasar-lista</code> con IDs de ausentes<br>
6. Respuesta: Resumen de asistencia + nuevas sugerencias
</div>

<h3>2. Ver Detalles (Modal BottomSheet)</h3>
<pre>
// Cuando usuario hace tap en icono ğŸ” en CompactList
vm.showDetailsItem(item)

// ChatScreen renderiza ModalBottomSheet
if (ui.detailsItem != null) {
    ModalBottomSheet(onDismissRequest = vm::hideDetailsItem) {
        Column(padding = 16.dp) {
            Text("Detalles del registro", style = titleLarge)
            HorizontalDivider(...)
            
            // Por cada campo en el item
            itemMap.forEach { (key, value) ->
                Card(...) {
                    Text(key, style = labelMedium, color = #666666)
                    Text(formatValue(value), style = bodyMedium)
                }
            }
            
            Button(onClick = vm::hideDetailsItem) { Text("Cerrar") }
        }
    }
}
</pre>

<h3>3. AclaraciÃ³n de Sugerencias (SuggestionClarificationDialog)</h3>
<div class="component-box">
<strong>Componente:</strong> <code>ui/components/SuggestionClarificationDialog.kt</code><br>
<strong>Trigger:</strong> Cuando sugerencia tiene flag <code>needsClarification == true</code><br>
<strong>UI:</strong> AlertDialog con TextField pre-rellenado con <code>suggestion.displayText</code><br>
<strong>Acciones:</strong> Usuario edita el mensaje â†’ "Enviar" llama <code>vm.sendMessage(editedMessage)</code>
</div>

<h3>4. Formularios Interactivos (AlumnoAltaForm / AlumnoModificacionForm)</h3>
<table>
<tr>
<th>Formulario</th>
<th>Tipo Mensaje</th>
<th>Campos</th>
</tr>
<tr>
<td><code>AlumnoAltaForm</code></td>
<td><code>formulario_alta_alumno</code></td>
<td>Nombre, TelÃ©fono, Fecha Nacimiento, Email, DNI, DirecciÃ³n, Curso (dropdown)</td>
</tr>
<tr>
<td><code>AlumnoModificacionForm</code></td>
<td><code>formulario_modificacion_alumno</code></td>
<td>Mismos campos pero pre-rellenados con datos actuales del alumno</td>
</tr>
</table>

<p><strong>Botones del formulario:</strong></p>
<ul>
<li><code>onCancel</code> â†’ EnvÃ­a mensaje "cancelar alta" o "cancelar modificaciÃ³n"</li>
<li><code>onSubmit</code> â†’ Construye mensaje descriptivo + envÃ­a con contexto <code>{ "action": "submit_alta", "form_data": {...} }</code></li>
</ul>

<hr>

<h2>Resumen UX</h2>

<p>AcademiaAPP implementa un patrÃ³n de interacciÃ³n <strong>chat-first</strong>:</p>

<ul>
<li>âœ… <strong>Una sola pantalla</strong> (ChatScreen) post-login</li>
<li>âœ… <strong>NavegaciÃ³n conversacional</strong> mediante drawer + auto-envÃ­o de mensajes</li>
<li>âœ… <strong>Tarjetas contextuales</strong> (SesionesDelDiaCards, CompactList, AlumnosSesionTable)</li>
<li>âœ… <strong>InteracciÃ³n directa</strong> (checkboxes en tablas, botones en tarjetas)</li>
<li>âœ… <strong>Feedback visual</strong> (TypingIndicator, ModalBottomSheet, Snackbars)</li>
<li>âœ… <strong>Paleta WhatsApp</strong> (#128C7E, #DCF8C6, #ECE5DD) para familiaridad</li>
<li>âœ… <strong>Material Design 3</strong> con Jetpack Compose nativo</li>
</ul>

<hr>

<p style="text-align: center; color: #666; font-size: 12px; margin-top: 40px;">
Documento basado 100% en el cÃ³digo fuente de AcademiaAPP<br>
<strong>Ãngel FernÃ¡ndez Vidal</strong> - TFG FP DAM - IES Fernando Wirtz SuÃ¡rez<br>
Noviembre 2025
</p>

</body>
</html>
