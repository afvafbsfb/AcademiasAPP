# Mapa Conceptual - Arquitectura Chat-Driven UI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         APLICACIÃ“N ANDROID                          â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    NavigationDrawer                          â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚  Header: Nombre Usuario + Rol/Academia            â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  ğŸ  Inicio                                                   â”‚  â”‚
â”‚  â”‚  ğŸ’¬ Chat Libre                                               â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                             â”‚  â”‚
â”‚  â”‚  [OPCIONES DINÃMICAS SEGÃšN ROL]                             â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                             â”‚  â”‚
â”‚  â”‚  âš™ï¸ ConfiguraciÃ³n                                            â”‚  â”‚
â”‚  â”‚  ğŸšª Cerrar sesiÃ³n                                            â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚  â”‚
â”‚  â”‚  â”‚ Al tocar una opciÃ³n:                â”‚                   â”‚  â”‚
â”‚  â”‚  â”‚ 1. Cerrar drawer                    â”‚                   â”‚  â”‚
â”‚  â”‚  â”‚ 2. Auto-enviar mensaje al chat      â”‚                   â”‚  â”‚
â”‚  â”‚  â”‚ 3. Simular respuesta (2-3.5s)       â”‚                   â”‚  â”‚
â”‚  â”‚  â”‚ 4. Mostrar sugerencias              â”‚                   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                       ChatScreen                             â”‚  â”‚
â”‚  â”‚                  *** ÃšNICA PANTALLA ***                      â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚  AppTopBar: "Chat asistente virtual"              â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚          Lista de mensajes (LazyColumn)           â”‚     â”‚  â”‚
â”‚  â”‚  â”‚                                                    â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  ğŸ‘¤ Usuario: "MuÃ©strame mis clases de hoy"        â”‚     â”‚  â”‚
â”‚  â”‚  â”‚                                                    â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  ğŸ¤– Asistente: "ğŸ“… Tus clases de hoy..."          â”‚     â”‚  â”‚
â”‚  â”‚  â”‚     [Tabla con datos mock]                        â”‚     â”‚  â”‚
â”‚  â”‚  â”‚     Sugerencias:                                  â”‚     â”‚  â”‚
â”‚  â”‚  â”‚     ğŸ” Ver detalle clase 08:00                    â”‚     â”‚  â”‚
â”‚  â”‚  â”‚     ğŸ“ Ver anotaciones                            â”‚     â”‚  â”‚
â”‚  â”‚  â”‚     â–¶ï¸ Iniciar sesiÃ³n                             â”‚     â”‚  â”‚
â”‚  â”‚  â”‚                                                    â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  [Al tocar sugerencia â†’ nuevo mensaje]           â”‚     â”‚  â”‚
â”‚  â”‚  â”‚                                                    â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚  [Input] "Escribe un mensaje..."  [Enviar ğŸ“¤]    â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

         â–¼                                           â–¼
         
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ChatViewModel      â”‚              â”‚  SessionStore        â”‚
â”‚                      â”‚              â”‚                      â”‚
â”‚  - messages: Flow    â”‚              â”‚  - name: Flow        â”‚
â”‚  - loading: Flow     â”‚              â”‚  - role: Flow        â”‚
â”‚  - sendMessage()     â”‚              â”‚  - academiaId: Flow  â”‚
â”‚  - reset()           â”‚              â”‚  - tokens: Flow      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
         
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ChatRepository (Interface)                      â”‚
â”‚                                                              â”‚
â”‚  suspend fun sendMessage(                                    â”‚
â”‚      messages: List<ChatMessageDto>,                         â”‚
â”‚      context: Map<String, Any?>?                             â”‚
â”‚  ): Result<Envelope<GenericItem>>                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼                              â–¼
         
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RealChatRepository   â”‚    â”‚  MockChatRepository           â”‚
â”‚ (Retrofit)           â”‚    â”‚  (Para demo/presentaciÃ³n)     â”‚
â”‚                      â”‚    â”‚                               â”‚
â”‚ - Llama al backend   â”‚    â”‚ - Detecta currentScreen       â”‚
â”‚ - Usa tokens JWT     â”‚    â”‚ - Genera respuestas mock      â”‚
â”‚                      â”‚    â”‚ - Simula latencia 2-3.5s      â”‚
â”‚                      â”‚    â”‚ - Incluye sugerencias         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â–¼
                                         
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚      MockData                 â”‚
                            â”‚                               â”‚
                            â”‚  - getCursos()                â”‚
                            â”‚  - getAlumnos()               â”‚
                            â”‚  - getSesiones()              â”‚
                            â”‚  - getProfesores()            â”‚
                            â”‚  - getAnotaciones()           â”‚
                            â”‚  - etc.                       â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ FLUJO DE NAVEGACIÃ“N DETALLADO

### Ejemplo: Profesor â†’ "Mis Clases Hoy" â†’ "Ver detalle" â†’ "Pasar lista"

```
1. Usuario abre drawer
   â†“
2. Toca "ğŸ“… Mis Clases Hoy"
   â†“
3. handleMenuClick() detecta:
   - option.id = "mis_clases_hoy"
   - option.chatMessage = "MuÃ©strame mis clases de hoy"
   - context = { currentScreen: "mis_clases_hoy", role: "Profesor_academia" }
   â†“
4. Drawer se cierra
   â†“
5. ChatViewModel.sendMessageWithContext()
   - AÃ±ade mensaje del usuario al estado
   - Muestra "loading" (burbuja con puntos animados)
   â†“
6. MockChatRepository.sendMessage()
   - delay(random(2000, 3500))  // Simular latencia
   - Detecta context.currentScreen == "mis_clases_hoy"
   - Genera respuesta:
     * message: "ğŸ“… Tus clases de hoy - MiÃ©rcoles, 23/10/2025"
     * data.items: [clase1, clase2, ...]
     * uiSuggestions: ["Ver detalle 08:00", "Ver anotaciones", ...]
   â†“
7. ChatScreen renderiza respuesta:
   - Texto del asistente
   - Tabla con CompactList (hora, curso, aula, estado)
   - Chips de sugerencias
   â†“
8. Usuario toca sugerencia "ğŸ” Ver detalle clase 08:00"
   â†“
9. Suggestion.onClick():
   - vm.disableSuggestionsForMessage(messageIndex)
   - vm.sendMessage("Ver detalle de la clase de 08:00")
   - context actualizado: { 
       currentScreen: "detalle_sesion",
       sesionId: "1",
       cursoId: "5"
     }
   â†“
10. MockChatRepository detecta currentScreen == "detalle_sesion"
    - Genera respuesta con detalles de la sesiÃ³n
    - Nuevas sugerencias: ["â–¶ï¸ Iniciar sesiÃ³n", "âœ… Pasar lista", ...]
    â†“
11. Usuario toca "âœ… Pasar lista"
    â†“
12. MockChatRepository detecta action == "pasar_lista"
    - Genera tabla interactiva de alumnos
    - data.items: alumnos con estado de asistencia
    - Sugerencias por alumno: "Ver anotaciones de X"
    - Sugerencias globales: "ğŸ’¾ Guardar lista"
    â†“
13. Usuario marca ausencias/presencias
    â†“
14. Toca "ğŸ’¾ Guardar lista"
    â†“
15. MockChatRepository simula guardado
    - delay(1500)
    - Responde: "âœ… Lista guardada correctamente"
    - Nueva sugerencia: "â†©ï¸ Volver a mis clases"
```

---

## ğŸ—‚ï¸ ESTRUCTURA DEL CONTEXTO

### Context Map que viaja con cada mensaje:

```kotlin
val context = mapOf(
    // Pantalla/Flujo actual
    "currentScreen" to "detalle_sesion",      // DÃ³nde estÃ¡ el usuario
    "previousScreen" to "mis_clases_hoy",     // De dÃ³nde viene
    
    // Datos del usuario
    "role" to "Profesor_academia",
    "academiaId" to 5,
    "usuarioId" to 12,
    
    // Recursos en contexto (IDs de registros activos)
    "sesionId" to "1",
    "cursoId" to "5",
    "alumnoId" to null,  // null si no aplica
    
    // AcciÃ³n/OperaciÃ³n actual
    "actionType" to "pasar_lista",  // "consulta" | "alta" | "modificacion" | "baja"
    
    // Filtros activos
    "filters" to mapOf(
        "fecha" to "2025-10-23",
        "estado" to "activo"
    ),
    
    // Token de sesiÃ³n conversacional (futuro)
    "conversationToken" to "conv_abc123xyz",
    
    // NavegaciÃ³n
    "canGoBack" to true,
    "parentResource" to "mis_clases_hoy"
)
```

---

## ğŸ“Š MAPEO: OpciÃ³n del MenÃº â†’ Mock Response

| OpciÃ³n del MenÃº | currentScreen | Mock Response Incluye |
|-----------------|---------------|----------------------|
| **Mis Clases Hoy** | `mis_clases_hoy` | Lista de sesiones de hoy + sugerencias: "Ver detalle", "Iniciar sesiÃ³n" |
| **Mis Clases Semana** | `mis_clases_semana` | Lista de sesiones semanales + filtros por dÃ­a |
| **Mis Cursos** | `mis_cursos` | Lista de cursos del profesor + "Ver alumnos", "Historial" |
| **Mis Anotaciones** | `mis_anotaciones` | Lista Ãºltimas anotaciones + "Nueva anotaciÃ³n", "Filtrar" |
| **Cursos** (Admin) | `cursos` | Lista de cursos de la academia + "Crear curso", "Ver detalle" |
| **Alumnos** (Admin) | `alumnos` | Lista de alumnos + "Alta alumno", "Ver detalle" |
| **Profesores** (Admin) | `profesores` | Lista de profesores + "Asignar a curso", "Ver detalle" |
| **GestiÃ³n EconÃ³mica** | `gestion_economica` | Extractos pendientes + "Movimientos", "Registrar pago" |
| **Academias** (Super) | `academias` | Lista de academias + "Ver detalle", "Crear academia" |

---

## ğŸ¨ COMPONENTES UI REUTILIZABLES

### CompactList (ya existe en ChatScreen.kt)
- âœ… Tabla genÃ©rica con scroll
- âœ… summaryFields para columnas
- âœ… BotÃ³n "Ver detalle" por fila
- âœ… PaginaciÃ³n automÃ¡tica (mostrar 5, luego expandir)

### SuggestionChip (ya existe)
- âœ… Chips interactivos
- âœ… Se desactivan al hacer click
- âœ… Tipos: GenÃ©rica, PaginaciÃ³n, Registro

### TypingIndicator (ya existe)
- âœ… Puntos animados mientras carga
- âœ… Aparece como burbuja del asistente

### ModalBottomSheet para detalles (ya existe)
- âœ… Muestra todos los campos de un registro
- âœ… Formato limpio key-value

---

## âœ… CONCLUSIÃ“N

### Lo que YA tienes implementado:
- âœ… ChatScreen con toda la UI necesaria
- âœ… NavegaciÃ³n con drawer
- âœ… Componentes reutilizables (CompactList, chips, etc.)
- âœ… Sistema de sugerencias tipadas
- âœ… GestiÃ³n de estado con ViewModel

### Lo que FALTA implementar:
- âŒ MenÃº dinÃ¡mico por rol (1 dÃ­a)
- âŒ MockChatRepository con respuestas contextuales (2 dÃ­as)
- âŒ MockData con datos realistas (1 dÃ­a)
- âŒ LÃ³gica de contexto y navegaciÃ³n profunda (1 dÃ­a)
- âŒ Pulido de UX y transiciones (1 dÃ­a)

**TOTAL: ~6-7 dÃ­as para tener demo completa** ğŸš€

### Ventajas de esta arquitectura:
1. âœ… **Simplicidad extrema**: Una sola pantalla
2. âœ… **Experiencia natural**: Todo es conversaciÃ³n
3. âœ… **FÃ¡cil de mockear**: Solo respuestas de texto + JSON
4. âœ… **Escalable**: AÃ±adir funciones = aÃ±adir casos al switch
5. âœ… **TransiciÃ³n suave**: Cuando tengas backend, solo cambias el repo
